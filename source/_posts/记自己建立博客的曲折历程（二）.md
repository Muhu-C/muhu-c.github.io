---
title: 记自己建立博客的曲折历程（二）
date: 2025-08-30 15:12:21
tags: 
    - 成长之路
    - 教程
categories: 学习
cover: https://www.helloimg.com/i/2025/08/27/68ae69574d7e6.png
---
  
*本文章是教程文章，可以按作者的步骤学习。*  
<br/>

## 前言

### 介绍   
- **公网(外网)** 即广域网，指的是公共网络，规模大，用户可以在不同地区访问公网的内容。
- **内网** 即局域网，规模一般在方圆几千米以内。正常情况下，家里的网络都是内网。内网里的设备可以访问内网的内容。如果内网的设备没有公网 IP，在公网上则无法访问内网。
- **Netlify Pages** 也是一个静态网页托管平台，可以从 Github 上直接导入 Pages。
- **Frp** 指的是内网穿透，它可以将内网的网站映射到外网，以供其他地区的用户使用。
- **Umami** 是一个网站访问统计系统，可以自行部署，也可以用 **Vercel + Cloudflare Workers** 部署。 

{% note 'warn' 'fas fa-triangle-exclamation' %}
由于 Vercel 和 Cloudflare Workers 在国内难以访问，因此国内选择本地部署 + Frp 内网穿透更好。   
{% endnote %}

{% gallery %}
![Cloudflare](https://www.helloimg.com/i/2025/08/30/68b2a66fe9f5a.png)
![Vercel](https://www.helloimg.com/i/2025/08/30/68b2a6720d5cf.png)
{% endgallery %}
  
  
### 提示  
此过程包含不少访问国外网站的要求，如无法访问，请使用 [Watt Toolkit](https://steampp.net/) 等加速软件。  
  
### 要求  
   
1. 一台可正常运行的 **Linux** 主机（以 Ubuntu 为例） 
2. 能访问 [Github](https://github.com/) 的网络 ( 可能需要 Watt Toolkit 等加速 )  
3. 一定的英语和 Linux 计算机知识储备   
4. **一个自己的域名**  

## 第一步 配置域名

### 配置博客网站的域名（Netlify 方式）

登录 [Netlify](https://netlify.com/) ，注册账号。  
点击 **Project -> Add new project -> Import an existing project**，再在跳出页面中点击 **Github**，找到自己的 Github Pages 并选中，填入 **Project name** 后若无其他需要配置的项目，下拉 **Deploy**，等待配置完成。  
  
找到 Projects / 你刚刚的 Project name，进入后来到左侧 Domain management，再找到 **Add Domain -> Add a domain you already own** 填入你的域名，并将要求的 **TXT 记录**添加至域名运营商的 DNS 配置里，等待配置完成后回到 Netlify，点击 **Add Subdomain / Add Domain** 完成网站配置。  

{% note 'warn' 'fas fa-triangle-exclamation' %}  
注意：刚配置完域名时，访问网站会出现 SSL 证书问题，需要等待一会才可以完成证书颁发   
{% endnote %}
  
### 配置你的 Umami API 网站的域名  
这一步需要使用 Frp。如你有带公网 IP 的服务器，请跳过此步。  

如你使用内网穿透平台提供的 Frp，请新建一个 HTTPS 隧道，并按照提示完成域名绑定。  
若是你自己/朋友的公网服务器提供的 Frp，请确保有 Https2http 的插件，并按照 [Fatedier/frp 的官方教程](https://gofrp.org/) 配置内网穿透，并将公网 IP 解析至域名。  


<br />

---

## 第二步 配置 Umami

<br />  

### 安装 PostgreSQL (以 Ubuntu 以及有 apt 的系统为例)

更新软件源  

```Bash
sudo apt update
```
  
安装 PostgreSQL  

```Bash
sudo apt install postgresql postgresql-contrib
```

验证服务状态  

```Bash
sudo systemctl status postgresql
```

切换到 PostgreSQL 的默认用户  

```Bash
sudo -i -u postgres
```

进入数据库命令行  

```Bash
psql
```

创建数据库（如命名为 umami_db）  


```SQL
CREATE DATABASE umami_db;
```

创建数据库用户（如 umami_user）并设置密码（替换 your_password 为密码）  

```SQL
CREATE USER umami_user WITH ENCRYPTED PASSWORD 'your_password';
```

授予用户权限（让 umami_user 能操作 umami_db ）  

```SQL
GRANT ALL PRIVILEGES ON DATABASE umami_db TO umami_user;
```

退出 PostgreSQL 命令行并退出 postgres 用户  

```Bash
\q
exit
```

<br />

### 安装 Umami
由于博客引擎为 Hexo，对 Node.js 的熟悉程度较深，本文提供手动安装 Umami 的方式  

安装 Node.js 和 Git

```Bash
sudo apt install nodejs npm git -y
```

#### 使用 Git 克隆

克隆 Umami 代码  

```Bash
git clone https://github.com/umami-software/umami.git
cd umami
```

#### 直接下载

{% link 'Umami' 'Github 地址' 'https://github.com/umami-software/umami' %}

#### 下载后  

解压并移动到需要放置的文件夹，保证 README.MD 所在的一层在此文件夹内

```Bash
cd 你移动到的文件夹
```

安装依赖  

```Bash
npm install
```

创建环境变量文件并使用 nano 编辑

```Bash
cp .env.example .env
nano .env
```

修改数据库配置 (其中 umami_user，your_password，umami_db 均为上文提到的内容，根据自己的情况配置)  
```.env
DATABASE_URL=postgresql://umami_user:your_password@localhost:5432/umami_db
```

初始化数据库并启动  

```Bash
npm run build
npm run start
```

